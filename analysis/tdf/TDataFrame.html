
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>TDataFrame Â· PEP root6 workshop</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-katex/katex.min.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-panels/panels.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-block-align/plugin.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
        <link rel="stylesheet" href="../../css/website.css">
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="more.html" />
    
    
    <link rel="prev" href="concept.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../introduction.html">
            
                <a href="../introduction.html">
            
                    
                    Part 1 - Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../feat2.html">
            
                <a href="../feat2.html">
            
                    
                    Part 2 - Smart (and dumb) pointers
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../newf2/intro.html">
            
                <a href="../newf2/intro.html">
            
                    
                    Pointers, the absolute basics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../newf2/smartp.html">
            
                <a href="../newf2/smartp.html">
            
                    
                    Smart pointers
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../cpp11.html">
            
                <a href="../cpp11.html">
            
                    
                    Part 3 - New C++11 features
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../cpp11/nullptr.html">
            
                <a href="../cpp11/nullptr.html">
            
                    
                    nullptr
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../cpp11/enums.html">
            
                <a href="../cpp11/enums.html">
            
                    
                    Strongly typed enums
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../cpp11/initlists.html">
            
                <a href="../cpp11/initlists.html">
            
                    
                    Initializer lists
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../cpp11/auto.html">
            
                <a href="../cpp11/auto.html">
            
                    
                    Implicit typing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../cpp11/rangebasediterators.html">
            
                <a href="../cpp11/rangebasediterators.html">
            
                    
                    Range-based iterations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../cpp11/stl.html">
            
                <a href="../cpp11/stl.html">
            
                    
                    Standard library
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../cpp11/lambda.html">
            
                <a href="../cpp11/lambda.html">
            
                    
                    lambda expressions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../cpp11/variadic.html">
            
                <a href="../cpp11/variadic.html">
            
                    
                    Variadic templates
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../cpp11/move.html">
            
                <a href="../cpp11/move.html">
            
                    
                    Move semantics
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../parallellism.html">
            
                <a href="../parallellism.html">
            
                    
                    Part 4 - Parallellism
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../parallell/intro.html">
            
                <a href="../parallell/intro.html">
            
                    
                    Threads and processes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../parallell/example.html">
            
                <a href="../parallell/example.html">
            
                    
                    Posix multithreading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../parallell/root.html">
            
                <a href="../parallell/root.html">
            
                    
                    Parallellism with ROOT
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="../changes.html">
            
                <a href="../changes.html">
            
                    
                    Part 5 - 5 to 6: changes to user code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="../vectorization.html">
            
                <a href="../vectorization.html">
            
                    
                    Part 6 - Vectorization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="declarative.html">
            
                <a href="declarative.html">
            
                    
                    Part 7 - Declarative analysis
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="concept.html">
            
                <a href="concept.html">
            
                    
                    Declarative programming
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.8.2" data-path="TDataFrame.html">
            
                <a href="TDataFrame.html">
            
                    
                    TDataFrame
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="more.html">
            
                <a href="more.html">
            
                    
                    Additional material
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="../python/">
            
                <a href="../python/">
            
                    
                    Part 8 - Python
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../python/running.html">
            
                <a href="../python/running.html">
            
                    
                    Running
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../python/operators.html">
            
                <a href="../python/operators.html">
            
                    
                    Objects and operators
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../python/numbers.html">
            
                <a href="../python/numbers.html">
            
                    
                    Numbers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../python/strings.html">
            
                <a href="../python/strings.html">
            
                    
                    Strings
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../python/lists.html">
            
                <a href="../python/lists.html">
            
                    
                    Lists and looping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../python/dictionaries.html">
            
                <a href="../python/dictionaries.html">
            
                    
                    Dictionaries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../python/conditions.html">
            
                <a href="../python/conditions.html">
            
                    
                    Conditions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../python/methods.html">
            
                <a href="../python/methods.html">
            
                    
                    Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.9" data-path="../python/scripting.html">
            
                <a href="../python/scripting.html">
            
                    
                    Scripting
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.10" data-path="../python/modules.html">
            
                <a href="../python/modules.html">
            
                    
                    Modules
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.11" data-path="../python/learning.html">
            
                <a href="../python/learning.html">
            
                    
                    Learning more
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.12" data-path="../python/pyroot.html">
            
                <a href="../python/pyroot.html">
            
                    
                    PyROOT
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../bestprac/best_prac.html">
            
                <a href="../bestprac/best_prac.html">
            
                    
                    Part 9 - Best Practices
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.10.1" data-path="../bestprac/preparing.html">
            
                <a href="../bestprac/preparing.html">
            
                    
                    Preparing your code for debugging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.2" data-path="../bestprac/general.html">
            
                <a href="../bestprac/general.html">
            
                    
                    Some general programming tips
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.3" data-path="../bestprac/crash.html">
            
                <a href="../bestprac/crash.html">
            
                    
                    Where does my code crash
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10.4" data-path="../bestprac/memory.html">
            
                <a href="../bestprac/memory.html">
            
                    
                    Finding memory leaks
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >TDataFrame</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="tdataframe">TDataFrame</h1>
<p>ROOT&apos;s TDataFrame offers a high level interface for analyses of data stored in <em>TTrees*</em>.</p>
<p>In addition, multi-threading and other low-level optimisations allow users to exploit all the resources available on their machines completely transparently.
Skip to the class reference or keep reading for the user guide.</p>
<p>In a nutshell:</p>
<pre><code class="lang-c++">ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;myTree&quot;</span>, file)</span></span>; <span class="hljs-comment">// Interface to TTree and TChain</span>
<span class="hljs-keyword">auto</span> myHisto = d.Histo1D(<span class="hljs-string">&quot;Branch_A&quot;</span>); <span class="hljs-comment">// This happens in parallel!</span>
myHisto-&gt;Draw();
</code></pre>
<p>Depending on the ROOT6 version:</p>
<pre><code class="lang-c++">ROOT::<span class="hljs-function">RDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;myTree&quot;</span>, file)</span></span>; <span class="hljs-comment">// Interface to TTree and TChain</span>
<span class="hljs-keyword">auto</span> myHisto = d.Histo1D(<span class="hljs-string">&quot;Branch_A&quot;</span>); <span class="hljs-comment">// This happens in parallel!</span>
myHisto-&gt;Draw();
</code></pre>
<p>Calculations are expressed in terms of a type-safe functional chain of actions and transformations, TDataFrame takes care of their execution. The implementation automatically puts in place several low level optimisations such as multi-thread parallelisation and caching.</p>
<h2 id="introduction">Introduction</h2>
<p>A pipeline of operations is described to be performed on the data, the framework takes care of the management of the loop over entries as well as low-level details such as I/O and parallelisation. TDataFrame provides an interface to perform most common operations required by ROOT analyses; at the same time, the users are not limited to those common operations: building blocks to trigger custom calculations are available too.</p>
<p>TDataFrame is built with a modular and flexible workflow in mind, summarised as follows:</p>
<ul>
<li><p><strong>build</strong> a data-frame object by specifying your data-set</p>
</li>
<li><p><strong>apply a series of transformations</strong> to your data</p>
<ul>
<li><strong>filter</strong> (e.g. apply some cuts) or</li>
<li>create a <strong>temporary column</strong> (e.g. the result of an expensive computation on branches, or an alias for a branch)</li>
</ul>
</li>
<li><strong>apply actions</strong> to the transformed data to produce results (e.g. fill a histogram)</li>
</ul>
<h6 id="ttreereader">TTreeReader</h6>
<pre><code class="lang-c++"><span class="hljs-function">TTreeReader <span class="hljs-title">reader</span><span class="hljs-params">(<span class="hljs-string">&quot;myTree&quot;</span>, file)</span></span>;
TTreeReaderValue&lt;A_t&gt; a(reader, <span class="hljs-string">&quot;A&quot;</span>);
TTreeReaderValue&lt;B_t&gt; b(reader, <span class="hljs-string">&quot;B&quot;</span>);
TTreeReaderValue&lt;C_t&gt; c(reader, <span class="hljs-string">&quot;C&quot;</span>);
<span class="hljs-keyword">while</span>(reader.Next()) {
  <span class="hljs-keyword">if</span>(IsGoodEvent(a, b, c))
      DoStuff(a, b, c);
}
</code></pre>
<h6 id="rootexperimentaltdataframe">ROOT::Experimental::TDataFrame</h6>
<pre><code class="lang-c++">ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;myTree&quot;</span>, file, {<span class="hljs-string">&quot;A&quot;</span>, <span class="hljs-string">&quot;B&quot;</span>, <span class="hljs-string">&quot;C&quot;</span>})</span></span>;
d.Filter(IsGoodEvent).Foreach(DoStuff);
</code></pre>
<h6 id="ttreedraw">TTree::Draw</h6>
<pre><code class="lang-c++">TTree *t = <span class="hljs-keyword">static_cast</span>&lt;TTree*&gt;(
   file-&gt;Get(<span class="hljs-string">&quot;myTree&quot;</span>)
);
t-&gt;Draw(<span class="hljs-string">&quot;var&quot;</span>, <span class="hljs-string">&quot;var &gt; 2&quot;</span>);
</code></pre>
<h6 id="rootexperimentaltdataframe">ROOT::Experimental::TDataFrame</h6>
<pre><code class="lang-c++">ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;myTree&quot;</span>, file, <span class="hljs-string">&quot;var&quot;</span>)</span></span>;
d.Filter([](<span class="hljs-keyword">int</span> v) { <span class="hljs-keyword">return</span> v &gt; <span class="hljs-number">2</span>; }).Histo1D();
</code></pre>
<p>Keep reading to follow a five-minute crash course to TDataFrame, or jump to an overview of useful features, or a more in-depth explanation of transformations, actions and parallelism.</p>
<h2 id="crash-course">Crash course</h2>
<h6 id="filling-a-histogram">Filling a histogram</h6>
<p>Let&apos;s start with a very common task: filling a histogram</p>
<pre><code class="lang-c++"><span class="hljs-comment">// Fill a TH1F with the &quot;MET&quot; branch</span>
ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;myTree&quot;</span>, filePtr)</span></span>; <span class="hljs-comment">// build a TDataFrame like you would build a TTreeReader</span>
<span class="hljs-keyword">auto</span> h = d.Histo1D(<span class="hljs-string">&quot;MET&quot;</span>);
h-&gt;Draw();
</code></pre>
<p>The first line creates a TDataFrame associated to the TTree &quot;myTree&quot;. This tree has a branch named &quot;MET&quot;.</p>
<p>Histo1D is an action; it returns a smart pointer (a TResultProxy to be precise) to a TH1F histogram filled with the MET of all events. If the quantity stored in the branch is a collection, the histogram is filled with its elements.</p>
<p>There are many other possible actions, and all their results are wrapped in smart pointers; we&apos;ll see why in a minute.</p>
<h6 id="applying-a-filter">Applying a filter</h6>
<p>Let&apos;s now pretend we want to cut over the value of branch &quot;MET&quot; and count how many events pass this cut:</p>
<pre><code class="lang-c++"><span class="hljs-comment">// Select events with &quot;MET&quot; greater than 4., count events that passed the selection</span>
<span class="hljs-keyword">auto</span> metCut = [](<span class="hljs-keyword">double</span> x) { <span class="hljs-keyword">return</span> x &gt; <span class="hljs-number">4.</span>; }; <span class="hljs-comment">// a c++11 lambda function checking &quot;x &gt; 4&quot;</span>
ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;myTree&quot;</span>, filePtr)</span></span>;
<span class="hljs-keyword">auto</span> c = d.Filter(metCut, {<span class="hljs-string">&quot;MET&quot;</span>}).Count();
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; *c &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
</code></pre>
<p>Filter takes a function (a lambda in this example, but it can be any kind of function or even a functor class) and a list of branch names. The filter function is applied to the specified branches for each event; it is required to return a bool which signals whether the event passes the filter (true) or not (false). You can think of your data as &quot;flowing&quot; through the chain of calls, being transformed, filtered and finally used to perform actions. Multiple Filter calls can be chained one after another. It is possible to specify filters as strings too. This snippet is analogous to the one above:</p>
<pre><code class="lang-c++">ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;myTree&quot;</span>, filePtr)</span></span>;
<span class="hljs-keyword">auto</span> c = d.Filter(<span class="hljs-string">&quot;MET &gt; 4.&quot;</span>).Count();
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; \*c &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
Here the names of the branches used in the expression and their types are inferred automatically. The <span class="hljs-built_in">string</span> must be standard C++ and is just-in-time compiled by the ROOT interpreter, Cling.
</code></pre>
<h6 id="running-on-a-range-of-entries">Running on a range of entries</h6>
<p>It is sometimes necessary to limit the processing of the dataset to a range of entries. For this reason, the TDataFrame offers the concept of ranges as a node of the TDataFrame graph: this means that filters, columns and actions can be hung to it. If a range is specified after a filter, the range will act exclusively on the entries surviving the filter. Here you can find some code using ranges:</p>
<pre><code class="lang-c++">ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(<span class="hljs-string">&quot;myTree&quot;</span>, filePtr)</span></span>;
<span class="hljs-comment">// This is how you can express a range of the first 30 entries</span>
<span class="hljs-keyword">auto</span> d_0_30 = d.Range(<span class="hljs-number">0</span>, <span class="hljs-number">30</span>);
<span class="hljs-comment">// This is how you pick all entries from 15 onwards</span>
<span class="hljs-keyword">auto</span> d_15_end = d.Range(<span class="hljs-number">15</span>, <span class="hljs-number">0</span>);
<span class="hljs-comment">// We can use a stride too, in this case we pick an event every 3</span>
<span class="hljs-keyword">auto</span> d_15_end_3 = d.Range(<span class="hljs-number">15</span>, <span class="hljs-number">0</span>, <span class="hljs-number">3</span>);
Ranges are not available when multi-threading is enabled.
</code></pre>
<h6 id="creating-a-temporary-column">Creating a temporary column</h6>
<p>Let&apos;s now consider the case in which &quot;myTree&quot; contains two quantities &quot;x&quot; and &quot;y&quot;, but our analysis relies on a derived quantity z = sqrt(x<em>x + y</em>y). Using the Define transformation, we can create a new column in the data-set containing the variable &quot;z&quot;:</p>
<pre><code class="lang-c++"><span class="hljs-keyword">auto</span> sqrtSum = [](<span class="hljs-keyword">double</span> x, <span class="hljs-keyword">double</span> y) { <span class="hljs-keyword">return</span> <span class="hljs-built_in">sqrt</span>(x*x + y*y); };
<span class="hljs-keyword">auto</span> zCut = [](<span class="hljs-keyword">double</span> z) { <span class="hljs-keyword">return</span> z &gt; <span class="hljs-number">0.</span>; }
ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(treeName, filePtr)</span></span>;
<span class="hljs-keyword">auto</span> zMean = d.Define(<span class="hljs-string">&quot;z&quot;</span>, sqrtSum, {<span class="hljs-string">&quot;x&quot;</span>,<span class="hljs-string">&quot;y&quot;</span>})
              .Filter(zCut, {<span class="hljs-string">&quot;z&quot;</span>})
              .Mean(<span class="hljs-string">&quot;z&quot;</span>);
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; \*zMean &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
</code></pre>
<p>Define creates the variable &quot;z&quot; by applying sqrtSum to &quot;x&quot; and &quot;y&quot;. Later in the chain of calls we refer to variables created with Define as if they were actual tree branches, but they are evaluated on the fly, once per event. As with filters, Define calls can be chained with other transformations to create multiple temporary columns. As with filters, it is possible to specify new columns as strings too. This snippet is analogous to the one above:</p>
<pre><code class="lang-c++">ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(treeName, filePtr)</span></span>;
<span class="hljs-keyword">auto</span> zMean = d.Define(<span class="hljs-string">&quot;z&quot;</span>, <span class="hljs-string">&quot;sqrt(x*x + y*y)&quot;</span>)
              .Filter(<span class="hljs-string">&quot;z &gt; 0.&quot;</span>)
              .Mean(<span class="hljs-string">&quot;z&quot;</span>);
<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; \*zMean &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>;
</code></pre>
<p>Again the names of the branches used in the expression and their types are inferred automatically. The string must be standard C++ and is just-in-time compiled by the ROOT interpreter, Cling.</p>
<h6 id="executing-multiple-actions">Executing multiple actions</h6>
<p>As a final example let us apply two different cuts on branch &quot;MET&quot; and fill two different histograms with the &quot;pt_v&quot; of the filtered events. You should be able to easily understand what&apos;s happening:</p>
<pre><code class="lang-c++"><span class="hljs-comment">// fill two histograms with the results of two opposite cuts</span>
<span class="hljs-keyword">auto</span> isBig = [](<span class="hljs-keyword">double</span> x) { <span class="hljs-keyword">return</span> x &gt; <span class="hljs-number">10.</span>; };
ROOT::Experimental::<span class="hljs-function">TDataFrame <span class="hljs-title">d</span><span class="hljs-params">(treeName, filePtr)</span></span>;
<span class="hljs-keyword">auto</span> h1 = d.Filter(isBig, {<span class="hljs-string">&quot;MET&quot;</span>}).Histo1D(<span class="hljs-string">&quot;pt_v&quot;</span>);
<span class="hljs-keyword">auto</span> h2 = d.Histo1D(<span class="hljs-string">&quot;pt_v&quot;</span>);
h1-&gt;Draw();       <span class="hljs-comment">// event loop is run once here</span>
h2-&gt;Draw(<span class="hljs-string">&quot;SAME&quot;</span>); <span class="hljs-comment">// no need to run the event loop again</span>
</code></pre>
<p>TDataFrame executes all above actions by running the event-loop only once. The trick is that actions are not executed at the moment they are called, but they are lazy, i.e. delayed until the moment one of their results is accessed through the smart pointer. At that time, the even loop is triggered and all results are produced simultaneously.</p>
<p>It is therefore good practice to declare all your filters and actions before accessing their results, allowing TDataFrame to loop once and produce all results in one go.</p>
<h6 id="going-parallel">Going parallel</h6>
<p>Let&apos;s say we would like to run the previous examples in parallel on several cores, dividing events fairly between cores. The only modification required to the snippets would be the addition of this line before constructing the main data-frame object:</p>
<pre><code class="lang-c++">ROOT::EnableImplicitMT();
</code></pre>
<p><img src="speedup.png" alt="speedup"></p>
<p>Simple as that, enjoy your speed-up. Or a crash...</p>
<h6 id="demo-on-tdf-and-csv">Demo on TDF and CSV</h6>
<hr>
<h3 id="exercise">Exercise</h3>
<p>Now it&apos;s your turn. Use an existing macro you have to perfom analysis on a tree and write one that does the same but uses the TDataFrame.</p>
<p>Or look for a csv file online and play around with this.
Or use the tree maker macro by Redmer in the section on parllelism.</p>
<p>Have fun!</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="concept.html" class="navigation navigation-prev " aria-label="Previous page: Declarative programming">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="more.html" class="navigation navigation-next " aria-label="Next page: Additional material">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"TDataFrame","level":"1.8.2","depth":2,"next":{"title":"Additional material","level":"1.8.3","depth":2,"path":"analysis/tdf/more.md","ref":"analysis/tdf/more.md","articles":[]},"previous":{"title":"Declarative programming","level":"1.8.1","depth":2,"path":"analysis/tdf/concept.md","ref":"analysis/tdf/concept.md","articles":[]},"dir":"ltr"},"config":{"plugins":["katex","panels@git+https://github.com/lhcb/gitbook-plugin-panels.git#117012fdc18c96831cb88196980c0ea73b0c87b8","collapsible-menu","block-align"],"styles":{"website":"css/website.css"},"pluginsConfig":{"collapsible-menu":{},"block-align":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"panels":{},"katex":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"PEP root6 workshop","gitbook":"*","description":"PEP root6 introduction material"},"file":{"path":"analysis/tdf/TDataFrame.md","mtime":"2018-11-22T11:00:17.288Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-11-22T14:30:33.494Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-panels/panels.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-collapsible-menu/plugin.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

